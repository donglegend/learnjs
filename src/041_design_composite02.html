<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>041_design_composite02</title>
    <!-- 引入的核心js公共文件 -->
    <script type="text/javascript" src="../commons/CommonUtil.js"></script>
    <script type="text/javascript">
            // 组合模式 
            /**
             *  组合模式应用的场景和特点:
             *  场景:1.存在着一批组织成某种层次体系的对象
             *       2.希望对这批对象会其中的某一部分实施一个操作
             *  应用特点:1.组合模式中只有两种类型对象:组合对象.叶子对象
             *           2.这两种类型都实现同一批接口
             *           3.会在组合对象中调用其方法并隐式的调用下级的方法(采用递归的形式去做)
             *  
             */
            /*
             * 场景模拟：
             *  -> 公司 
             *     ->北京分公司
             *              -> 开发部门
             *                      -> 张一
             *                      -> 张二
             *                      -> 张三
             *              -> 设计部门
             *                      -> 张四
             *                      -> 张五
             *                      -> 张六
             *     ->长沙分公司
             *              -> 开发部门
             *                      -> 张一
             *                      -> 张二
             *                      -> 张三
             *              -> 设计部门
             *                      -> 张四
             *                      -> 张五
             *                      -> 张六
             *  
             *      实际的任务具体是落实到人上去实施的
             *      也就是说只有人才具有具体的方法实现
             *          
             */   
            var CompositeInterface = new CT.Interface('CompositeInterface',['addChild','getChild']);
            var LeafInterface = new CT.Interface('LeafInterface',['hardworking','sleeping']);

            var Composite = function(name){
                this.name =  name ;
                this.type = 'Composite';  //说明对象的类型(Composite)
                this.children = [];       //承装孩子的数字

            };
            Composite.prototype = {
                constructor : Composite ,
                addChild : function(child){
                    this.children.push(child);
                    return this ;
                },
                getChild : function(name){
                    //接收叶子对象类型的数组
                    var elements = [];
                    //判断对象是否为leaf类型的 如果是直接加到elements数组中 不是直接继续递归调用
                    var pushLeaf = function(item){
                            if(item.type === 'Composite'){
                                item.children.each(arguments.callee);
                            }else if(item.type === 'Leaf'){
                                elements.push(item);
                            }
                        };

                    //根据name让指定name下所有类型为leaf的对象去执行操作
                    if(name && this.name !==name){
                        this.children.each(function(item){
                            //如果你传递的name是二级节点名称
                            if(item.name === name && item.type === 'Composite'){
                                item.children.each(pushLeaf);

                            }
                            //如果传递name是三级节点或四级节点等
                            if(item.name !== name && item.type === 'Composite'){
                                item.children.each(arguments.callee);
                            }
                            //如果传递的name是叶子节点的时候
                            if(item.name === name && item.type === 'Leaf'){
                                elements.push(item);
                            }
                        });
                        

                    }
                    //不传递name让整个公司所有类型为leaf的对象去执行操作
                    else{
                        this.children.each(pushLeaf);
                            /*{
                            if(item.type === 'Composite'){
                                item.children.each(arguments.callee);
                            }else if(item.type === 'Leaf'){
                                elements.push(item);
                            }
                        });*/

                    }

                    return elements;

                },
                hardworking : function(name){
                    //得到所有的leaf类型的对象数组
                    var leafObjects = this.getChild(name) ;
                    for(var i = 0 ; i<leafObjects.length ; i++){
                        leafObjects[i].hardworking();
                    }
                },
                sleeping : function(name){
                    var leafObjects = this.getChild(name) ;
                    for(var i = 0 ; i<leafObjects.length ; i++){
                        leafObjects[i].sleeping();
                    }
                }
            };

            var Leaf = function(name){
                this.name = name ;
                this.type = 'Leaf';   //说明对象的类型(Leaf)
            };
            Leaf.prototype = {
                constructor : Leaf ,
                addChild : function(child){
                    throw new Error('this method is disable...');
                },
                getChild : function(name){
                    if(this.name = name){
                        return this ;
                    }
                    return null ;
                },
                hardworking : function(){
                    document.write(this.name + '...努力工作');
                },
                sleeping : function(){
                    document.write(this.name + '...午休');
                }
            };
            
            //测试数据
            var l1 = new Leaf('张1');
            var l2 = new Leaf('张2');
            var l3 = new Leaf('张3');
            var l4 = new Leaf('张4');
            var l5 = new Leaf('张5');
            var l6 = new Leaf('张6');
            var l7 = new Leaf('张7');
            var l8 = new Leaf('张8');
            var l9 = new Leaf('张9');
            var l10 = new Leaf('张1');
            var l11 = new Leaf('张11');
            var l12 = new Leaf('张12');
            

            var com1 = new Composite('北京开发部门');
            com1.addChild(l1).addChild(l2).addChild(l3);
            var com2 = new Composite('北京设计部门');
            com2.addChild(l4).addChild(l5).addChild(l6);

            var com3 = new Composite('上海开发部门');
            com3.addChild(l7).addChild(l8).addChild(l9);
            var com4 = new Composite('上海设计部门');
            com4.addChild(l10).addChild(l11).addChild(l12);

            var org1 = new Composite('北京分公司');
            org1.addChild(com1).addChild(com2);

            var org2 = new Composite('上海分公司');
            org2.addChild(com3).addChild(com4);

            var org = new Composite('总部');
            org.addChild(org1).addChild(org2);
            

            //让整个公司下所有的员工都努力工作
            
           // org.hardworking('总部');   不传递name和传递name效果一样
           org.hardworking('张12'); 

            
    
    </script>
</head>
<body>
    
</body>
</html>